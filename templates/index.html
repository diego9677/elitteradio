{% extends 'base.html' %}


{% block title %}ElitteRadio{% endblock %}


{% block head %}
<style>
    /* Estilos base compatibles con todos los navegadores */
    .range-slider {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        width: 100%;
        height: 4px;
        background: transparent;
        outline: none;
        margin: 15px 0;
    }

    /* WebKit (Chrome, Safari) */
    .range-slider::-webkit-slider-runnable-track {
        width: 100%;
        height: 4px;
        background: #d1d5db;
        /* Fondo gris de la barra */
        border-radius: 2px;
    }

    .range-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 16px;
        height: 16px;
        background: #ffffff;
        /* Thumb completamente blanco */
        border: none;
        /* Sin borde */
        border-radius: 50%;
        cursor: pointer;
        margin-top: -6px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    /* Firefox */
    .range-slider::-moz-range-track {
        width: 100%;
        height: 4px;
        background: #d1d5db;
        border-radius: 3px;
    }

    .range-slider::-moz-range-progress {
        height: 4px;
        background: #ffffff;
        /* Progreso blanco */
        border-radius: 3px;
    }

    .range-slider::-moz-range-thumb {
        width: 16px;
        height: 16px;
        background: #ffffff;
        border: none;
        /* Sin borde */
        border-radius: 50%;
        cursor: pointer;
    }

    /* Edge/IE */
    .range-slider::-ms-track {
        width: 100%;
        height: 4px;
        background: transparent;
        border-color: transparent;
        color: transparent;
    }

    .range-slider::-ms-fill-lower {
        background: #ffffff;
        border-radius: 3px;
    }

    .range-slider::-ms-fill-upper {
        background: #d1d5db;
        border-radius: 3px;
    }

    .range-slider::-ms-thumb {
        width: 16px;
        height: 16px;
        background: #ffffff;
        border: none;
        /* Sin borde */
        border-radius: 50%;
        cursor: pointer;
        margin-top: 0;
    }
</style>
{% endblock %}


{% block content %}
<section id="main" x-data="radioPlayer()" class="fixed inset-0 flex flex-col bg-white">

    <section id="radio-list" hx-get="{% url 'radio-list' %}" hx-trigger="load, every 60s" hx-swap="innerHTML"
        class="flex-1 overflow-auto space-y-4 p-4 w-full md:w-[540px] mx-auto">

        <div class="flex justify-center items-center h-full">
            <span class="text-blue-500 animate-spin">
                {% with 50 as size %}
                {% include 'includes/icons/spinner_icon.html' %}
                {% endwith %}
            </span>
        </div>

    </section>

    <footer x-show="streamUrl !== ''" class="h-20 bg-gray-600 flex items-center w-full md:w-[540px] mx-auto"
        style="display: none;">
        <audio x-ref="player"></audio>

        <div class="flex-1 flex items-center gap-2 justify-start h-full pl-2">

            <div class="w-14 h-14 flex items-center justify-center">
                <img :src="imgUrl" :alt="radioName" class="object-cover rounded-lg">
            </div>

            <p class="text-xs font-semibold text-white line-clamp-2" x-text="radioName"></p>
        </div>

        <div class="flex gap-2 items-center">
            <button type="button" @click="previous" class="w-10 h-10 text-white flex items-center justify-center">
                {% include 'includes/icons/player_back_icon.html' %}
            </button>

            <template x-if="!isPlaying">
                <div class="w-16 h-16 bg-black bg-opacity-30 rounded-full flex items-center justify-center">
                    <button @click="play"
                        class="flex justify-center items-center rounded-full h-10 w-10 bg-black ring-2 ring-white">
                        <span class="text-xs font-semibold text-white">
                            {% include 'includes/icons/play_icon.html' %}
                        </span>
                    </button>
                </div>
            </template>

            <template x-if="isPlaying">
                <div class="w-16 h-16 bg-black bg-opacity-30 rounded-full flex items-center justify-center">
                    <button @click="pause"
                        class="flex justify-center items-center rounded-full h-10 w-10 bg-black ring-2 ring-white">
                        <span class="text-xs font-semibold text-white">
                            {% include 'includes/icons/pause_icon.html' %}
                        </span>
                    </button>
                </div>
            </template>

            <button type="button" @click="next" class="w-10 h-10 text-white flex items-center justify-center">
                {% include 'includes/icons/player_next_icon.html' %}
            </button>
        </div>

        <div class="flex-1 flex justify-end pr-2">
            <section class="flex items-center gap-1 w-24">
                <button class="text-white" @click="toggleVolume">

                    <span x-show="volume === 0" style="display: none;">
                        {% include 'includes/icons/mute_icon.html' %}
                    </span>

                    <span x-show="volume > 0">
                        {% include 'includes/icons/volume_icon.html' %}
                    </span>

                </button>


                <input class="p-0 m-0 w-full cursor-pointer range-slider" type="range" min="0" max="1" step="0.05"
                    x-model.number="volume" @input="updateVolume" />

            </section>
        </div>

    </footer>

</section>
{% endblock %}



{% block scripts %}
<script>
    document.getElementById('main').style.height = `${window.innerHeight}px`;

    console.log(`${window.innerHeight}px`)

    function radioPlayer() {
        return {
            selectedIndex: null,
            totalRadios: Number('{{ object_list|length|default:"0" }}'),
            imgUrl: '',
            radioName: '',
            streamUrl: '', // URL de ejemplo
            isPlaying: false,
            volume: 0.5,
            changeAudio(index) {
                const radioElement = document.querySelector(`[data-radio-index="${index}"]`);
                if (!radioElement) return;

                this.pause();
                this.selectedIndex = index;
                this.streamUrl = radioElement.dataset.radioUrl + '/stream';
                this.imgUrl = radioElement.dataset.radioImg;
                this.radioName = radioElement.dataset.radioName;
                this.play();
            },
            play() {
                if (this.streamUrl && this.selectedIndex !== null) {
                    this.$refs.player.src = this.streamUrl;
                    this.$refs.player.play();
                    this.isPlaying = true;
                }
            },
            pause() {
                this.$refs.player.pause();
                this.$refs.player.currentTime = 0;
                this.isPlaying = false;
            },
            // Funci√≥n para actualizar el volumen
            updateVolume() {
                this.$refs.player.volume = this.volume;
            },

            toggleVolume() {
                this.volume = this.volume === 0 ? 1 : 0;
                this.updateVolume();
            },
            next() {
                if (this.selectedIndex === null) return;
                const nextIndex = (this.selectedIndex + 1) % this.totalRadios;
                this.changeAudio(nextIndex);
            },

            previous() {
                if (this.selectedIndex === null) return;
                const prevIndex = (this.selectedIndex - 1 + this.totalRadios) % this.totalRadios;
                this.changeAudio(prevIndex);
            },
        };
    }
</script>

{% endblock %}